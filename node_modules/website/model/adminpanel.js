/**
 * Created by igorkasyanenko on 10.05.16.
 */
var dbModule = require('dbmodule');
var qs = require('querystring');

exports.getQuestions = function (body) {

    var post = qs.parse(body);
//    console.log(post);
//res.write(body);
    if (post['json']) {
        var json = JSON.parse(post['json']);

        var added = json['rows']['added'];
        var deleted = json['rows']['deleted'];
        var updated = json['rows']['updated'];

        added.forEach(function (item, i, arr) {
            dbModule.addQuestion(
                item['updated_time'],
                item['updated_time'],
                item['level'],
                item['text'],
                item['answer1'],
                item['answer2'],
                item['answer3'],
                item['answer4'],
                item['true_answer']);
        });

        deleted.forEach(function (item, i, arr) {
            dbModule.deleteQuestion(
                item['id']);
        });

        updated.forEach(function (item, i, arr) {
            dbModule.updateQuestion(
                item['id'],
                item['updated_time'],
                item['level'],
                item['text'],
                item['answer1'],
                item['answer2'],
                item['answer3'],
                item['answer4'],
                item['true_answer']);
        });

        //console.log(updated)

    }

// dbModule.addQuestion(addDate,updateDate,level,text,ans1,ans2,ans3,ans4,trueAnsw);
    dbModule.getAllQuestions(function (error, result) {
        data = result;
        renderDataWithTemplate(data, '/views/adminpanel/index.html', res);
    });
}