/**
 * Created by igorkasyanenko on 22.04.16.
 */
var handlebars = require('handlebars');
var fs = require('fs');
var path = require('path');
var routing = require('routing');
var dbModule = require('dbmodule');
var qs = require('querystring');

var adminpanel = require('./controllers/adminpanel');
var authorization = require('./controllers/authorization');

module.exports = function (db) {
    var module = {};


    routing.addRoutes({
        '/millionaire/adminpanel': function (client, par) {
            if (authorization.checkAccess(client.req)) {
                return adminpanel.index(null, client.res, function (err, result) {
                    client.res.end(result);
                });
            } else {
                client.res.writeHead(302, {
                    'Location': '/millionaire/auth'
                });
                client.res.end();
                return undefined;
            }

        }
    });

    routing.addRoutes({
        '/millionaire/adminpanel/questions': function (client, par) {
            if (authorization.checkAccess(client.req)) {
                return adminpanel.questionsList(client.req, client.res, function (err, result) {
                    client.res.end(result);
                });
            } else {
                client.res.writeHead(302, {
                    'Location': '/millionaire/auth'
                });
                client.res.end();
                return undefined;
            }

        }
    });

    routing.addRoutes({
        '/millionaire/auth': function (client, par) {
            return authorization.login(client.req, client.res);
        }
    });

    /*
    routing.addRoutes({
        '/millionaire/test': function (client, par) {
            var arr = [];
            arr.push("kook=7788")
            client.res.setHeader("Set-Cookie", arr);
            client.res.end("hello");
            return undefined;
        }
    });
*/
    /*
     module.router = function router(req,res,path) {
     switch (req.url){
     case path+"adminpanel":
     adminpanel.index(null,res);

     break;
     case path+"adminpanel/questions":
     adminpanel.questionsList(req,res);

     break;


     case path+"auth":
     authorization.login(req,res);
     break; 
     case path:

     break;

     default:

     break;
     }
     }
     */


    module.questionsList = function questionsList(req, res) {
        //adminpanel.questionsList(req,res);
        return adminpanel.questionsList(req, res, function (err, result) {
            res.end(result);
        });
    }

    module.index = function index(res) {
        adminpanel.index(null, res);
    }


    module.authorization = function (req, res) {
        authorization.login(req, res);
    };


    return module;
};


